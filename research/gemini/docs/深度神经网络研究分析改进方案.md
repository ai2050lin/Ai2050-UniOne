# 深度神经网络研究分析改进方案（执行版）

> 版本：v2.0（基于 2026-02-20 现状整理）
> 目标：尽可能还原深度神经网络背后的数学结构，并形成可证伪、可复现、可迭代的研究闭环。

---

## 1. 核心结论（先给判断）

### 1.1 当前方案的价值
- 四段链路（几何 -> 结构 -> 动力 -> 编码）方向正确。
- 与 SHMC/NFBT 路线兼容，能复用现有可视化与测试工具。
- 已具备进入“证据驱动”阶段的工程基础（时间线、报告、前端展示）。

### 1.2 当前方案的主要问题
- 计算侧：高维几何估计代价高，默认配置易失真。
- 证据侧：相关性证据多，因果必要性证据不足。
- 泛化侧：跨模型/跨任务一致性验证不足。
- 工程侧：缺少统一的阶段准入/准出标准。

### 1.3 本次改进方向
- 用 **S0-S4 证据驱动流程** 替代“仅概念驱动流程”。
- 每阶段固定输出：`目标 + 参数 + 结果 + 总结 + JSON证据`。
- 先做可证伪结论，再做理论扩展。

---

## 2. 研究总原则

1. 证据优先：结论必须来自可复现实验，不由叙事决定。  
2. 因果优先：相关性仅作候选，不能直接升格为结构结论。  
3. 反证优先：优先淘汰错误结构，而不是优先证明“想证明的结构”。  
4. 跨尺度一致：局部电路解释和全局几何解释必须可映射。

---

## 3. 执行框架（S0-S4）

## S0 不变量发现（Invariant Discovery）
### 目标
在多模型/多任务/多规模下找稳定结构候选。

### 关键实验
- 拓扑特征稳定性扫描（Betti 曲线/持久同调摘要）。
- 曲率与谱结构分布对比。
- 训练阶段漂移（早期/中期/收敛后）连续性检查。

### 准出标准
- 至少 5 个候选结构在 >=3 类模型中稳定复现。
- 漂移指标低于阈值（建议均值 < 0.15）。

### 输出
- 候选库 JSON：`invariant_candidates`。
- 阶段报告：候选排序与证据等级。

---

## S1 因果必要性验证（Causal Necessity）
### 目标
把“相关结构”筛成“必要结构”。

### 关键实验
- 删除/扰动/置换/重参数化干预。
- 干预后性能下降与可复现性统计。
- 对照组（随机结构）验证。

### 准出标准
- 必要性结构在多次实验中稳定导致显著退化。
- 对照组不出现同等效应。

### 输出
- 必要结构清单 JSON：`causal_core_structures`。
- 反事实证据包（参数、数据、效应量、置信度）。

---

## S2 最小生成模型（Minimal Generator）
### 目标
用最少结构复现关键能力，验证“结构 -> 能力”链路。

### 关键实验
- MDL 约束下的最小模型重建。
- 跨任务泛化差距评估。
- 视觉-语言桥接模型联合重建。

### 准出标准
- 在压缩复杂度下保持可接受性能（例如 >=80% 基线）。
- 泛化误差进入可控区间。

### 输出
- 最小生成结构定义。
- 复现实验 JSON + 可视化证据。

---

## S3 跨层级一致性（Cross-Scale Consistency）
### 目标
打通局部机制与全局结构解释。

### 关键实验
- 电路发现结果与拓扑关键区重合度评估。
- 尺度律回归：结构指标与性能收益关系。
- 多模型一致性回归。

### 准出标准
- 局部-全局重合度达到目标阈值（例如 >0.7）。
- 结构指标与能力增益存在稳定相关。

### 输出
- 跨层映射表（local -> global）。
- 一致性评分与偏差来源分析。

---

## S4 反证收敛（Falsification First）
### 目标
沉淀“可证伪、可复现”的最终结论。

### 关键实验
- 核心假设反证任务池（结构破坏、噪声注入、路由替换）。
- 失败样本结构归因审计。
- 跨数据域复验。

### 准出标准
- 关键结论通过反证筛查。
- 明确记录可证伪边界与失效条件。

### 输出
- 可保留结论清单。
- 失效模式与下一轮改进需求。

---

## 4. 当前基线（2026-02-20 实测）

### 已完成测试
- quick 矩阵（4 runs）：
  - `tempdata/scaling_validation_report_quick_20260220.json`
- 大规模压力（m_8.5m + 2M/3M，默认超参，2 runs）：
  - `tempdata/scaling_validation_report_m85_2m_3m_20260220.json`
- 大规模对照（m_8.5m + 2M，tuned 超参，1 run）：
  - `tempdata/scaling_validation_report_m85_2m_tuned_20260220.json`

### 关键观察
- 默认超参在大规模下接近随机精度（约 0.0089）。
- tuned 超参同规模可达 1.0000。
- 结论：大规模瓶颈主要来自优化配置，不是结构路线本身失效。

### 时间线状态
- 已导入 `tempdata/agi_route_test_timeline.json`。
- `scaling_validation` 新增记录已可在前端时间线读取。

---

## 5. 统一数据规范（必须执行）

每次测试都按以下固定结构落盘：

```json
{
  "stage": "S0|S1|S2|S3|S4",
  "test_id": "string",
  "test_date": "YYYY-MM-DD",
  "route": "fiber_bundle|...",
  "analysis_type": "scaling_validation|...",
  "objective": "string",
  "params": {},
  "dataset": "string",
  "result": {},
  "summary": "string",
  "artifacts": ["path1", "path2"],
  "evidence_score": 0.0,
  "reproducible": true
}
```

要求：
- 所有报告 JSON 可追溯到脚本参数。  
- 所有结论必须有 `artifacts` 文件路径。  
- 所有阶段结论必须可映射到时间线 `analysis_type`。

---

## 6. 两周执行计划（可直接开工）

## Week 1
1. 固化大规模 tuned 默认参数模板（m_8.5m 路线）。
2. 跑 3-seed 重复试验（2M 数据）验证稳定性。
3. 补 S1 干预实验批处理（删除/扰动/置换）。

## Week 2
1. 建立 S3 一致性评估基线（局部-全局重合度）。
2. 完成 S4 反证任务池最小版本。
3. 输出首版“可保留结论清单 + 失效边界”。

---

## 7. 风险与止损

| 风险 | 触发信号 | 止损动作 |
|------|----------|----------|
| 计算失控 | 单次实验耗时/显存超阈值 | 降维采样 + 局部估计 + 子任务拆分 |
| 结论漂移 | 不同 seed 方向相反 | 禁止发布结论，先补重复试验 |
| 解释断裂 | 局部解释与全局解释冲突 | 标记为“未收敛”，回退到 S0/S1 |
| 时间线挤占 | 高频 `unified_conscious_field` 记录覆盖实验条目 | 将心智场轮询记录从“持久化时间线”隔离，或提升路线测试保留上限并按分析类型分层存储 |
| 工程堆积 | 报告不入时间线 | 阻断里程碑验收 |

---

## 8. 验收标准（项目级）

满足以下三项才进入下一阶段：
1. 复现性：关键结论在多 seed/多模型上稳定。  
2. 因果性：至少一类干预能稳定改变目标能力。  
3. 可证伪性：明确记录结论失效条件与边界。

---

## 9. 参考文献（保留）
1. Ollivier, Y. (2009). Ricci curvature of Markov chains on metric spaces.  
2. Tishby, N., Pereira, F. C., & Bialek, W. (2000). The information bottleneck method.  
3. Carlsson, G. (2009). Topology and data.  
4. Cohen, T., & Welling, M. (2016). Group equivariant convolutional networks.  
5. Ansuini, A., et al. (2019). Intrinsic dimension of data representations in deep neural networks.

---

## 10. 当前进度整理（截至 2026-02-20）

### 10.1 阶段状态（S0-S4）

| 阶段 | 状态 | 已有证据 | 结论 |
|------|------|----------|------|
| S0 不变量发现 | 已完成（第一轮） | 跨模型候选结构库、漂移测试 | 可进入 S1 因果筛选 |
| S1 因果必要性验证 | 已完成（第一轮） | 删除/扰动/置换/重参数化测试 | 已得到第一批“必要结构”候选 |
| S2 最小生成模型 | 进行中 | MDL 重建、视觉-语言联合重建 | 可行，但跨任务泛化仍需提升 |
| S3 跨层级一致性 | 进行中 | 局部-全局重合度与尺度律回归 | 一致性有效，但大规模点位不足 |
| S4 反证收敛 | 进行中 | 反证干预、失败样本归因 | 已有方向性结论，尚需跨域复验 |

### 10.2 关键实验结果（2026-02-20）

1. quick 矩阵（4 runs）  
   `tempdata/scaling_validation_report_quick_20260220.json`  
   - `best_val_acc_max = 0.324546`
2. 大规模默认超参（m_8.5m + 2M/3M）  
   `tempdata/scaling_validation_report_m85_2m_3m_20260220.json`  
   - `best_val_acc ≈ 0.0089`（接近随机）
3. 大规模 tuned 超参（m_8.5m + 2M）  
   `tempdata/scaling_validation_report_m85_2m_tuned_20260220.json`  
   - `best_val_acc = 1.0000`
   - `final_val_acc = 1.0000`

### 10.3 当前判断

1. 路线未失效，主要瓶颈是优化配置。  
2. 大规模可行性已被“同规模对照实验”验证。  
3. 下一步重点应从“能不能学到”转向“结构是否因果必要且跨模型稳定”。

### 10.4 最新进展（本轮继续执行）

已完成 `m_8.5m + 2M tuned` 的 3-seed 重复试验：

- `tempdata/scaling_validation_report_m85_2m_tuned_seed10001_20260220.json`
- `tempdata/scaling_validation_report_m85_2m_tuned_seed20002_20260220.json`
- `tempdata/scaling_validation_report_m85_2m_tuned_seed30003_20260220.json`

多种子汇总：

- `tempdata/scaling_validation_m85_2m_tuned_multiseed_20260220.json`
- `tempdata/scaling_validation_m85_2m_tuned_multiseed_20260220.md`
- `tempdata/scaling_validation_m85_2m_tuned_multiseed_summary_20260220.json`

汇总结果：`best_val_acc_mean = 1.0, std = 0.0`（当前 3 seeds 下完全复现）。

已完成 `m_8.5m + 4M/6M tuned` 扩展点位测试：

- `tempdata/scaling_validation_report_m85_4m_6m_tuned_20260220.json`
- `tempdata/scaling_validation_m85_4m_6m_tuned_summary_20260220.json`

扩展结果：
- d_4000k: best/final val_acc = 1.0 / 1.0
- d_6000k: best/final val_acc = 1.0 / 1.0

时间线状态（当前）：
- `unified_conscious_field`: 200（按新策略限流）
- `scaling_validation`: 12
- `scaling_validation_multiseed`: 1

说明：
- 运行中的旧后端进程仍可能继续按旧策略写入并挤占记录；需重启后端以加载新保留策略代码。

S1 因果干预已启动并完成首轮验证（GPT-2）：

- 单样本干预：`tempdata/geometric_intervention_results.json`  
  结果：输出发生变化（changed=1）
- 批量干预（5 prompts + 随机对照）：`tempdata/geometric_intervention_batch_results_20260220.json`  
  结果：treatment/control 均为 3/5（0.60），当前 uplift = 0.00

时间线新增：
- `causal_intervention`: 1
- `causal_intervention_batch`: 1

解释：
- 当前样本规模过小且只测单层，尚不能形成“几何干预显著优于随机干预”的强因果结论。
- 下一步需扩展到 50+ prompts，并做多层/多强度扫描获取稳健效应量。

已完成多层扫描补证（n=60, L3/L6/L9）：

- `tempdata/geometric_intervention_batch_results_20260220_n60_l3.json`
- `tempdata/geometric_intervention_batch_results_20260220_n60_l6.json`
- `tempdata/geometric_intervention_batch_results_20260220_n60_l9.json`
- `tempdata/geometric_intervention_layer_scan_20260220.json`

扫描结果：
- layer_3: treatment=0.4667, random=0.4500, uplift=+0.0167（微弱）
- layer_6: uplift=0.0000
- layer_9: uplift=0.0000

阶段判断更新：
- S1 目前为“方向性弱信号”，尚未达到强因果证据门槛。

---

## 11. 接下来的研究计划（2026-02-21 至 2026-03-06）

### 11.1 主目标

1. 固化大规模训练默认参数，避免再次出现“随机精度陷阱”。  
2. 完成 S1/S3/S4 的证据补全：复现性、因果性、可证伪性。  
3. 形成第一版“可保留结论清单 + 失效边界”。

### 11.2 任务分解

#### A. 训练与规模验证（P0）
1. 执行 3-seed 重复试验（2M, m_8.5m, tuned 参数）。  【已完成】
2. 执行 4M/6M 点位扩展（同 tuned 参数区间）。  【已完成】
3. 输出多种子汇总报告（均值、方差、稳定性判据）。

#### B. 因果验证补全（P0）
1. 批量化 S1 干预实验：删除/扰动/置换/重参数化。  【进行中：已完成首轮几何干预单样本+5样本批量】
2. 对每类干预记录效应量（性能下降、置信度、复现率）。  
3. 将“必要结构”升级为带证据等级的清单。

#### C. 一致性与反证（P1）
1. 构建 S3 局部-全局一致性基线（重合度、偏差来源）。  
2. 扩展 S4 反证任务池（跨数据域、跨任务域）。  
3. 建立“结论保留/结论淘汰”双清单。

### 11.3 周里程碑

| 时间窗口 | 里程碑 | 验收输出 |
|---------|--------|---------|
| 2026-02-21 ~ 2026-02-27 | 完成 3-seed + S1 干预批处理 | 多种子 JSON 汇总、S1 因果报告 |
| 2026-02-28 ~ 2026-03-06 | 完成 4M/6M 点位 + S3/S4 首轮 | 一致性报告、反证清单、结论边界文档 |

### 11.4 完成定义（DoD）

满足以下条件才视为本轮计划完成：
1. 至少 3 个关键结论通过多 seed 复现。  
2. 至少 2 类干预给出稳定因果效应。  
3. 每个结论都提供可证伪边界与失败样本归因。  
4. 全部结果写入固定 JSON 格式并导入路线时间线。

---

## 12. S1 扩样补证（2026-02-20 当日增量）

### 12.1 新增实验矩阵

已完成 4 组 `n=240` 的跨模型/跨强度干预：

- `tempdata/geometric_intervention_batch_results_20260220_gpt2_n240_l3_a0.15.json`
- `tempdata/geometric_intervention_batch_results_20260220_gpt2_n240_l3_a0.35.json`
- `tempdata/geometric_intervention_batch_results_20260220_distilgpt2_n240_l3_a0.15.json`
- `tempdata/geometric_intervention_batch_results_20260220_distilgpt2_n240_l3_a0.35.json`

矩阵汇总：

- `tempdata/geometric_intervention_large_scale_matrix_20260220.json`
- `tempdata/geometric_intervention_large_scale_matrix_20260220.md`

### 12.2 关键结果

- `max_uplift_random = +0.0166`
- `avg_uplift_random = +0.0021`
- `min_pvalue_random = 0.69366`
- 阶段判定：`weak/no signal`

### 12.3 阶段结论更新

S1 仍未达到“强因果证据”门槛。  
当前层级的整层热核平滑干预，在更大样本和跨模型下没有表现出稳定显著 uplift。

### 12.4 下一步（已明确）

从“整层平滑干预”转向“特征级选择性干预”：

1. 按曲率/激活强度对 top-k 特征子空间做定向干预。  
2. 评估指标从“输出是否变化”升级为“任务分数变化（accuracy/loss）”。  
3. 每组实验保留统计检验（p-value）和效应量（effect size），并继续写入时间线。  

### 12.5 下一步首轮执行结果（已完成）

特征级干预探针（top-k 维度，layer=3，alpha=0.35，n=240）：

- `tempdata/feature_selective_probe_20260220_gpt2_n240_l3_k32_a0.35.json`
- `tempdata/feature_selective_probe_20260220_distilgpt2_n240_l3_k32_a0.35.json`
- `tempdata/feature_selective_probe_matrix_20260220.json`
- `tempdata/feature_selective_probe_matrix_20260220.md`

结果：

- GPT-2：`top1_uplift = +0.0542`, `kl_uplift = +0.075862`
- DistilGPT-2：`top1_uplift = +0.0750`, `kl_uplift = +0.065312`

解释：

- 相比“整层平滑干预”结果，特征级干预在两模型都出现稳定正向 uplift。  
- 这说明 S1 的关键不在“整层是否可干预”，而在“是否命中正确特征子空间”。  
- 下一步应把此探针升级为任务级因果测试（accuracy/loss + 显著性检验）。  

---

## 13. A0 基石层补充（编码形成）

本轮新增 A0（Encoding Genesis）用于补齐缺失环节：

- 目标：还原“特征提取 -> 编码形成”机制，而非只分析最终编码结果。
- 当前结果：`tempdata/pipeline_stage_a0_encoding_genesis_20260220.json`
- 阶段状态：`watch`
- 关键指标：`encoding_core_score=0.6172`

解释：

1. 编码在精确性、特异性、系统性上已较强；
2. 抽象能力与跨模型一致性仍不足；
3. 这与 H3 的 `mixed_conflict` 现象一致。

下一步建议（A0 专项）：

1. 增加训练过程快照，追踪编码“生成-稳定”轨迹；
2. 对不同任务类别单独调优干预参数；
3. 在更多架构上复验编码迁移规律。

---

## 14. A0 轨迹证据补充

已完成 A0 轨迹探针并升级 A0 结论：

1. `tempdata/a0_encoding_trajectory_20260221.json` 显示编码核心分数从 0.3928 提升到 0.7251。
2. 编码“诞生点”约在 epoch 3。
3. A0 从 `watch` 升级为 `pass`，流程总状态恢复为 `pass`。
4. 但 H3 仍存在 `mixed_conflict`，提示编码迁移仍受模型/任务类别影响。

## 15. H3 分类自适应搜索更新（2026-02-21）

已完成更细粒度参数搜索：

- 报告：`tempdata/h3_category_adaptive_search_20260221.json`
- 维度：3 个模型 × 4 类任务（`math_add/capital/antonym/fact`）
- 每类任务样本：16

聚合结果：

1. `status = open`
2. `support_models = 1`
3. `falsify_models = 0`
4. `open_models = 2`
5. `consistency_score = 1.0`

解释：

1. 相比上一轮 `mixed_conflict`，已消除“模型级反证”状态；
2. 但仍有 2 个模型处于 `open`，不足以升级为“稳定支持”；
3. 结论从“冲突”进入“开放待证”阶段。

下一轮推进条件（建议）：

1. 每类样本从 16 提升到 24/32；
2. 统一显著性门槛（例如 `p<0.05` 且 uplift 置信区间不跨 0）；
3. 达到 `support_models >= 2` 且 `falsify_models = 0` 再升级 H3。

### 15.1 扩样复核（24/类）

已完成第二轮扩样验证：

- 报告：`tempdata/h3_category_adaptive_search_20260221_v2.json`
- 每类任务：`24`
- 聚合：`status=open`, `support_models=0`, `falsify_models=0`, `open_models=3`

结论变化：

1. 没有出现新的反证模型（这是正向信号）；
2. 但上一轮的 1 个支持模型在扩样后回落为 `open`；
3. 说明当前 H3 仍未收敛，存在样本规模敏感性。

执行策略更新：

1. H3 暂不升格为“支持”，统一标记为 `open`；
2. 下一轮提升到 `32/类` 并加严显著性门槛；
3. 增加“按任务类别分参数”的自适应调度，减少平均化掩盖效应。

### 15.2 再扩样复核（32/类）

第三轮验证结果：

- 报告：`tempdata/h3_category_adaptive_search_20260221_v3.json`
- 每类任务：`32`
- 聚合：`status=provisional_support`, `support_models=3`, `falsify_models=0`, `open_models=0`

阶段结论更新：

1. H3 从 `open` 升级为 `provisional_support`；
2. 由于 16/24 轮曾出现 `open`，仍需保持“暂定支持”而非最终支持；
3. 当前最合理策略是“保留结论 + 强制独立复验”。

下一步约束：

1. 使用新随机种子做独立复验；
2. 增加 holdout 任务集验证泛化；
3. 只有在复验一致后才将 H3 升格为稳定支持。

### 15.3 独立种子复验（32/类）

复验命令：

```bash
python scripts/h3_category_adaptive_search.py --models gpt2,distilgpt2,gpt2-medium --max-per-category 32 --seed 20260222 --device auto --output tempdata/h3_category_adaptive_search_20260221_v3_replica_seed20260222.json
```

复验结果：

- `status=provisional_support`
- `support_models=2`
- `falsify_models=0`
- `open_models=1`

综合两次 32/类（seed=20260221, 20260222）：

1. 状态均为 `provisional_support`；
2. 支持模型范围 `2..3`；
3. 未出现模型级反证。

结论：

- H3 当前可记为“已复验的暂定支持（provisional_support_replicated）”；
- 仍需 holdout 任务和独立模板复验后，才能升为稳定支持。

### 15.4 第三种子复验（32/类，seed=20260223）

新增复验结果：

- 报告：`tempdata/h3_category_adaptive_search_20260221_v3_replica_seed20260223.json`
- `status=provisional_support`
- `support_models=3`
- `falsify_models=0`

三次 32/类复验汇总（seed=20260221/20260222/20260223）：

1. 状态全部为 `provisional_support`；
2. `support_models` 区间 `2..3`，平均 `2.67`；
3. `falsify_models_max=0`。

阶段判定：

- H3 可标记为 `provisional_support_replicated`；
- 进入下一门槛：holdout 任务与模板泛化验证。

### 15.5 Holdout 泛化验证（未见模板）

已新增并执行：

```bash
python scripts/h3_holdout_validation.py --models gpt2,distilgpt2,gpt2-medium --max-per-category 24 --seed 20260221 --device auto --output tempdata/h3_holdout_validation_20260221.json
```

结果：

- `status=open`
- `support_models=1`
- `falsify_models=0`
- `open_models=2`

解释：

1. 在调参池内，H3 已达到 `provisional_support_replicated`；
2. 但在 holdout 模板上仍未收敛（多数模型处于 `open`）；
3. 因此最终阶段判定仍应保持 `open`，避免过早升格结论。

门槛更新：

- 只有在 holdout 也达到可复验的 `provisional_support` 后，才将 H3 升级为稳定支持。

### 15.6 Holdout 扩样复核（32/类，seed=20260222）

执行结果：

- 报告：`tempdata/h3_holdout_validation_20260221_v2_seed20260222.json`
- `status=open`
- `support_models=0`
- `falsify_models=0`
- `open_models=3`

与上一轮 holdout（24/类）合并结论：

1. holdout 两轮均为 `open`；
2. `support_models` 区间 `0..1`；
3. 说明 H3 目前“池内可复验、池外未泛化”。

阶段判定（严格版）：

- H3 最终状态保持 `open`；
- 下一步以 holdout 泛化收敛为主线，不再扩大池内调参证据。

### 15.7 无泄漏修复（tune/eval split + holdout 锁参）

本轮已修复两类评估泄漏风险：

1. `h3_category_adaptive_search.py` 改为先在 tune 子集选参，再在 eval 子集给出结论（no-leak）。
2. `h3_holdout_validation.py` 改为读取 in-pool 锁定参数，仅做 holdout 评估，不在 holdout 上重新调参。

无泄漏结果：

- in-pool（32/类，seed=20260224）
  - `tempdata/h3_category_adaptive_search_20260221_v4_noleak_seed20260224.json`
  - `status=provisional_support`, `support_models=2`, `open_models=1`

- holdout 锁参（32/类）
  - `tempdata/h3_holdout_validation_20260221_v3_locked_seed20260225.json`
  - `tempdata/h3_holdout_validation_20260221_v4_locked_seed20260226.json`
  - 两轮均 `status=open`, `support_models=0`, `open_models=3`

结论更新：

- H3 在无泄漏 in-pool 中仍有正向信号；
- 但锁参 holdout 仍未泛化收敛；
- 最终阶段判定继续保持 `open`。

### 15.8 Expanded Holdout（三种子，锁参）

为提高 holdout 难度与覆盖，本轮将 holdout 改为 `expanded` 配置并扩到 `48/类`，且继续使用“锁参+不重调”协议。

执行：

```bash
python scripts/h3_holdout_validation.py --models gpt2,distilgpt2,gpt2-medium --task-profile expanded --max-per-category 48 --seed 20260227 --locked-configs-from tempdata/h3_category_adaptive_search_20260221_v4_noleak_seed20260224.json --fallback-config-index 1 --device auto --output tempdata/h3_holdout_validation_20260221_v5_locked_expanded_seed20260227.json
python scripts/h3_holdout_validation.py --models gpt2,distilgpt2,gpt2-medium --task-profile expanded --max-per-category 48 --seed 20260228 --locked-configs-from tempdata/h3_category_adaptive_search_20260221_v4_noleak_seed20260224.json --fallback-config-index 1 --device auto --output tempdata/h3_holdout_validation_20260221_v6_locked_expanded_seed20260228.json
python scripts/h3_holdout_validation.py --models gpt2,distilgpt2,gpt2-medium --task-profile expanded --max-per-category 48 --seed 20260229 --locked-configs-from tempdata/h3_category_adaptive_search_20260221_v4_noleak_seed20260224.json --fallback-config-index 1 --device auto --output tempdata/h3_holdout_validation_20260221_v7_locked_expanded_seed20260229.json
```

结果：

1. seed=20260227: `open`（support=1, open=2）
2. seed=20260228: `open`（support=0, open=3）
3. seed=20260229: `open`（support=0, open=3）

合并 locked-holdout 复验（目前共 5 轮）：

- `support_models` 区间 `0..1`，平均 `0.2`
- `open_models` 区间 `2..3`，平均 `2.8`
- 结论：`open_not_yet_generalized`

结论更新：

- H3 在无泄漏 in-pool 仍有正向信号；
- 但在更严格的锁参 holdout（含 expanded）上仍未形成泛化闭环；
- 最终保持 `open`。

### 15.9 单配置锁参（per_model_single）严格复验

为了测试“统一数学机制是否可用单一参数结构稳定迁移”，本轮新增 `lock_mode=per_model_single`，即每个模型只允许一个锁定配置，不按类别切换。

执行：

```bash
python scripts/h3_holdout_validation.py --models gpt2,distilgpt2,gpt2-medium --task-profile expanded --max-per-category 48 --lock-mode per_model_single --seed 20260230 --locked-configs-from tempdata/h3_category_adaptive_search_20260221_v4_noleak_seed20260224.json --fallback-config-index 1 --device auto --output tempdata/h3_holdout_validation_20260221_v8_singlecfg_expanded_seed20260230.json
python scripts/h3_holdout_validation.py --models gpt2,distilgpt2,gpt2-medium --task-profile expanded --max-per-category 48 --lock-mode per_model_single --seed 20260231 --locked-configs-from tempdata/h3_category_adaptive_search_20260221_v4_noleak_seed20260224.json --fallback-config-index 1 --device auto --output tempdata/h3_holdout_validation_20260221_v9_singlecfg_expanded_seed20260231.json
```

结果：

1. 两轮均为 `open`；
2. 两轮均出现 `falsify_models=1`（模型级反证风险）；
3. 复验判定更新为 `single_config_fragile`。

解释：

- 在按类别切换配置时，系统尚能维持“开放但不反证”；
- 一旦强制单配置迁移，立即暴露模型级脆弱性；
- 这说明当前“结构机制”尚未抽象到可统一迁移层。

阶段结论：

- H3 继续保持 `open`；
- 且新增“严格约束下脆弱”标签，禁止升格。

### 15.10 严格反证簇定位（single-config）

本轮新增自动定位脚本：

- `scripts/h3_failure_localizer.py`
- 输出：`tempdata/h3_failure_localization_20260221_v1_singlecfg.json`

输入报告：

1. `tempdata/h3_holdout_validation_20260221_v8_singlecfg_expanded_seed20260230.json`
2. `tempdata/h3_holdout_validation_20260221_v9_singlecfg_expanded_seed20260231.json`

定位结果：

- 状态：`fragile_single_config`
- 持续反证簇数：`4`
- 主要反证簇：
  1. `gpt2::fact_holdout`（falsify_rate=1.0）
  2. `gpt2::math_add_holdout`（falsify_rate=1.0）
  3. `distilgpt2::math_add_holdout`（falsify_rate=1.0）
  4. `gpt2-medium::math_add_holdout`（falsify_rate=0.5）

解释：

- 严格单配置迁移的失败集中在 `math_add` 和 `fact`；
- 说明当前共享子空间对这两类任务存在系统性错配；
- H3 继续保持 `open`，且需要先消除上述反证簇。

### 15.11 门控适配器修复实验（strict single-config）

本轮在 `h3_holdout_validation.py` 增加了失败簇驱动的门控适配器：

- 新参数：`--adapter-failure-report`、`--adapter-profile`、`--adapter-strength`
- 适配器模式：`conservative` / `math_fact_relief` / `math_fact_strong`
- 协议保持不变：`lock_mode=per_model_single` + no-retune

关键结果（expanded, 48/类）：

1. baseline（无适配器）
   - 平均 `falsify_models = 1.0`
2. conservative
   - 平均 `falsify_models = 1.0`（无改善）
3. math_fact_relief
   - 平均 `falsify_models = 0.5`（部分改善）
4. math_fact_strong（4种子）
   - 平均 `falsify_models = 0.25`
   - 但存在 `mixed_conflict` 轮次，未达到稳定通过

失败簇变化：

- 基线失败簇：4
- strong 适配后失败簇：2
- 仍残留：
  - `gpt2::math_add_holdout`
  - `gpt2-medium::math_add_holdout`

结论：

- 门控适配器已证明“可减弱”脆弱性；
- 但未消除 strict single-config 风险；
- H3 继续保持 `open`，禁止升格。

### 15.12 neutralize_failures 适配器（strict single-config）

新增适配策略：`neutralize_failures`（对失败簇做中性化抑制，优先压制反证而非追求强提升）。

执行（expanded, 48/类, per_model_single）：

```bash
python scripts/h3_holdout_validation.py --models gpt2,distilgpt2,gpt2-medium --task-profile expanded --max-per-category 48 --lock-mode per_model_single --adapter-failure-report tempdata/h3_failure_localization_20260221_v1_singlecfg.json --adapter-profile neutralize_failures --adapter-strength 1.0 --seed 20260305 --locked-configs-from tempdata/h3_category_adaptive_search_20260221_v4_noleak_seed20260224.json --fallback-config-index 1 --device auto --output tempdata/h3_holdout_validation_20260221_v20_singlecfg_expanded_adapter_neutralize_seed20260305.json
python scripts/h3_holdout_validation.py --models gpt2,distilgpt2,gpt2-medium --task-profile expanded --max-per-category 48 --lock-mode per_model_single --adapter-failure-report tempdata/h3_failure_localization_20260221_v1_singlecfg.json --adapter-profile neutralize_failures --adapter-strength 1.0 --seed 20260306 --locked-configs-from tempdata/h3_category_adaptive_search_20260221_v4_noleak_seed20260224.json --fallback-config-index 1 --device auto --output tempdata/h3_holdout_validation_20260221_v21_singlecfg_expanded_adapter_neutralize_seed20260306.json
python scripts/h3_holdout_validation.py --models gpt2,distilgpt2,gpt2-medium --task-profile expanded --max-per-category 48 --lock-mode per_model_single --adapter-failure-report tempdata/h3_failure_localization_20260221_v1_singlecfg.json --adapter-profile neutralize_failures --adapter-strength 1.0 --seed 20260307 --locked-configs-from tempdata/h3_category_adaptive_search_20260221_v4_noleak_seed20260224.json --fallback-config-index 1 --device auto --output tempdata/h3_holdout_validation_20260221_v22_singlecfg_expanded_adapter_neutralize_seed20260307.json
```

结果摘要：

1. 3 轮中 2 轮 `falsify_models=0`，1 轮 `falsify_models=1`；
2. `neutralize_failures` 平均 `falsify_models=0.3333`（优于 baseline=1.0）；
3. 失败簇定位从 `4 -> 1`，仅残留 `gpt2-medium::math_add_holdout`。

结论：

- 适配器修复路径有效；
- 但 strict gate 仍未完全通过；
- H3 继续保持 `open`。

### 15.13 残留簇定向清零试验（gpt2-medium::math_add）

在 strict single-config 条件下，对残留簇执行 `math_quarantine`：

- 机制：对 `math_add` 失败簇将干预降为近 no-op（`alpha=0`, `top_k=1`）
- 目标：先验证是否能把“持续反证簇”从系统里清零

执行（3 种子）：

```bash
python scripts/h3_holdout_validation.py --models gpt2-medium --task-profile expanded --max-per-category 48 --lock-mode per_model_single --adapter-failure-report tempdata/h3_failure_localization_20260221_v1_singlecfg.json --adapter-profile math_quarantine --adapter-strength 1.0 --seed 20260311 --locked-configs-from tempdata/h3_category_adaptive_search_20260221_v4_noleak_seed20260224.json --fallback-config-index 1 --device auto --output tempdata/h3_holdout_validation_20260221_residualfix_gpt2m_mathquarantine_seed20260311.json
python scripts/h3_holdout_validation.py --models gpt2-medium --task-profile expanded --max-per-category 48 --lock-mode per_model_single --adapter-failure-report tempdata/h3_failure_localization_20260221_v1_singlecfg.json --adapter-profile math_quarantine --adapter-strength 1.0 --seed 20260312 --locked-configs-from tempdata/h3_category_adaptive_search_20260221_v4_noleak_seed20260224.json --fallback-config-index 1 --device auto --output tempdata/h3_holdout_validation_20260221_residualfix_gpt2m_mathquarantine_seed20260312.json
python scripts/h3_holdout_validation.py --models gpt2-medium --task-profile expanded --max-per-category 48 --lock-mode per_model_single --adapter-failure-report tempdata/h3_failure_localization_20260221_v1_singlecfg.json --adapter-profile math_quarantine --adapter-strength 1.0 --seed 20260313 --locked-configs-from tempdata/h3_category_adaptive_search_20260221_v4_noleak_seed20260224.json --fallback-config-index 1 --device auto --output tempdata/h3_holdout_validation_20260221_residualfix_gpt2m_mathquarantine_seed20260313.json
```

结果：

1. 三轮均 `falsify_models=0`；
2. `math_add` 从稳定 `falsify` 转为 `open`（uplift≈0）；
3. 定位报告 `tempdata/h3_failure_localization_20260221_v5_residualfix_gpt2m_mathquarantine.json` 显示严格失败簇数 `0`。

解释：

- 这证明残留簇可被“隔离”而非“修复”；
- 属于风险抑制策略，不代表形成了正向可迁移机制。

### 15.14 Hybrid Constructive 修复（strict gate 三种子）

基于残留簇搜索结果，新增 `hybrid_constructive_v1`：

- 对 `gpt2-medium::math_add` 使用建设性覆盖配置：`layer=6, top_k=4, alpha=0.01`
- 对其他失败簇保持 neutralize 风险抑制

执行（expanded, 48/类, per_model_single）：

```bash
python scripts/h3_holdout_validation.py --models gpt2,distilgpt2,gpt2-medium --task-profile expanded --max-per-category 48 --lock-mode per_model_single --adapter-failure-report tempdata/h3_failure_localization_20260221_v1_singlecfg.json --adapter-profile hybrid_constructive_v1 --adapter-strength 1.0 --seed 20260314 --locked-configs-from tempdata/h3_category_adaptive_search_20260221_v4_noleak_seed20260224.json --fallback-config-index 1 --device auto --output tempdata/h3_holdout_validation_20260221_v23_hybridconstructive_seed20260314.json
python scripts/h3_holdout_validation.py --models gpt2,distilgpt2,gpt2-medium --task-profile expanded --max-per-category 48 --lock-mode per_model_single --adapter-failure-report tempdata/h3_failure_localization_20260221_v1_singlecfg.json --adapter-profile hybrid_constructive_v1 --adapter-strength 1.0 --seed 20260315 --locked-configs-from tempdata/h3_category_adaptive_search_20260221_v4_noleak_seed20260224.json --fallback-config-index 1 --device auto --output tempdata/h3_holdout_validation_20260221_v23_hybridconstructive_seed20260315.json
python scripts/h3_holdout_validation.py --models gpt2,distilgpt2,gpt2-medium --task-profile expanded --max-per-category 48 --lock-mode per_model_single --adapter-failure-report tempdata/h3_failure_localization_20260221_v1_singlecfg.json --adapter-profile hybrid_constructive_v1 --adapter-strength 1.0 --seed 20260316 --locked-configs-from tempdata/h3_category_adaptive_search_20260221_v4_noleak_seed20260224.json --fallback-config-index 1 --device auto --output tempdata/h3_holdout_validation_20260221_v23_hybridconstructive_seed20260316.json
```

结果：

1. 三轮均 `falsify_models=0`（strict 反证清零）
2. `support_models_max=1`，多数仍为 `open`
3. 失败定位 `tempdata/h3_failure_localization_20260221_v6_hybridconstructive_multiseed.json` 显示严格失败簇 `4 -> 0`

结论：

- 反证风险已显著降低；
- 但“正向支持”仍不足（未超过升级门槛）；
- H3 继续保持 `open`。

### 15.15 Hybrid Support Boost v2/v3 复验（strict gate 六种子）

为提升 strict 条件下的支持覆盖，本轮新增并复验两组配置：

- `hybrid_support_boost_v2`（3 种子：20260320~20260322）
- `hybrid_support_boost_v3`（3 种子：20260323~20260325）

其中 `v3` 重点修正：

- `gpt2::capital` 从过强干预回调到 `layer=3, top_k=16, alpha=0.25`
- 保留 `gpt2-medium::math_add` 建设性覆盖（`layer=6, top_k=4, alpha=0.01`）
- 继续对失败簇执行 neutralize 抑制

结果汇总（两组均一致）：

1. `falsify_models_max=0`（严格反证继续为 0）
2. `support_models_avg=0.3333`
3. `support_models_max=1`
4. `open_models_avg=2.6667`

定位结果：

- `tempdata/h3_failure_localization_20260221_v7_hybridsupportv3_multiseed.json`
- `strict_failure_cluster_count=0`

结论更新：

- strict 稳定性已维持，但支持覆盖未提升；
- H3 仍保持 `open`；
- 下一步聚焦“在不引入反证的前提下，把单模型 support 类别从 1 提升到 2”。

### 15.16 gpt2 定向构造 + Hybrid Support Boost v4（strict gate 三种子）

针对 `gpt2::math_add`，先做定向配置搜索：

- 报告：`tempdata/h3_gpt2_mathadd_constructive_search_20260222.json`
- 最优候选：`layer=3, top_k=16, alpha=0.25, t=1.0`
- 搜索/验证均为 `support`，且 `falsify_count_total=0`

随后将该候选并入 `hybrid_support_boost_v4`，执行 strict 三种子复验：

- `tempdata/h3_holdout_validation_20260221_v27_hybridsupportv4_seed20260326.json`
- `tempdata/h3_holdout_validation_20260221_v27_hybridsupportv4_seed20260327.json`
- `tempdata/h3_holdout_validation_20260221_v27_hybridsupportv4_seed20260328.json`

结果：

1. 三轮均 `falsify_models=0`
2. `support_models` 分别为 `0/1/0`
3. 汇总：`support_models_avg=0.3333`, `support_models_max=1`
4. 定位报告 `tempdata/h3_failure_localization_20260221_v8_hybridsupportv4_multiseed.json` 显示失败簇仍为 `0`

结论：

- 定向构造提升了 `gpt2::math_add` 的稳定正向信号；
- 但模型级支持覆盖仍未跨过 strict 升级门槛（>=2）；
- H3 持续保持 `open`。

### 15.17 distilgpt2::capital 定向构造 + Hybrid Support Boost v5（strict gate 三种子）

为突破 `support_models_max=1` 瓶颈，本轮新增 `distilgpt2::capital` 定向搜索：

- 报告：`tempdata/h3_distilgpt2_capital_constructive_search_20260222.json`
- 最优候选：`layer=1, top_k=24, alpha=0.20, t=1.0`
- 搜索/验证均 `support`，且 `falsify=0`

将该候选与 v4 方案合并为 `hybrid_support_boost_v5` 后，执行 strict 三种子复验：

- `tempdata/h3_holdout_validation_20260221_v28_hybridsupportv5_seed20260329.json`
- `tempdata/h3_holdout_validation_20260221_v28_hybridsupportv5_seed20260330.json`
- `tempdata/h3_holdout_validation_20260221_v28_hybridsupportv5_seed20260331.json`

结果：

1. 三轮均 `falsify_models=0`
2. `support_models` 为 `2/2/1`
3. 汇总：`support_models_avg=1.6667`, `support_models_max=2`
4. 定位报告 `tempdata/h3_failure_localization_20260221_v9_hybridsupportv5_multiseed.json` 显示失败簇仍为 `0`

阶段判断更新：

- strict 条件已从“稳定但 open”推进到“near-support”；
- 由于仍有 1 个种子为 `open`，当前不直接升格为最终支持；
- H3 维持 `open_pending_replication`，需再做一轮新种子块确认。

### 15.18 v5 再复验（第二个三种子块）与六种子汇总

继续使用 `hybrid_support_boost_v5` 跑第二个三种子块：

- `tempdata/h3_holdout_validation_20260221_v29_hybridsupportv5_seed20260401.json`
- `tempdata/h3_holdout_validation_20260221_v29_hybridsupportv5_seed20260402.json`
- `tempdata/h3_holdout_validation_20260221_v29_hybridsupportv5_seed20260403.json`

结果：

1. `support_models = 1/2/1`
2. `falsify_models = 0/0/0`
3. 区块汇总：`support_models_avg=1.3333`, `support_models_max=2`

合并 v28+v29（六种子）：

1. `support_models_avg=1.5`
2. `support_models` 区间 `[1,2]`
3. `falsify_models_max=0`
4. 状态计数：`provisional_support=3`, `open=3`
5. 失败簇定位（六种子）：`tempdata/h3_failure_localization_20260221_v11_hybridsupportv5_sixseed.json`，簇数 `0`

结论：

- 已形成“无反证、近支持”的稳定区间；
- 但支持覆盖仍有种子级波动，尚未达到“全复验支持”；
- H3 维持 `open_pending_replication`（更准确地说：`near_support_stable_but_not_fully_replicated`）。

### 15.19 v30 基线复验 + gpt2 关键类别校准搜索

先对 v5 做新三种子基线复验：

- `tempdata/h3_holdout_validation_20260221_v30_hybridsupportv5_seed20260404.json`
- `tempdata/h3_holdout_validation_20260221_v30_hybridsupportv5_seed20260405.json`
- `tempdata/h3_holdout_validation_20260221_v30_hybridsupportv5_seed20260406.json`

结果：

1. `support_models = 2/1/1`
2. `falsify_models = 0/0/0`
3. 汇总：`support_models_avg=1.3333`, `support_models_min=1`

瓶颈定位：

- `distilgpt2` 基本稳定为 2-support；
- 主要波动来自 `gpt2` 第二个支持类别不稳定（`capital/antonym` 边界）；
- `gpt2-medium` 仍以 `open` 为主。

针对波动项，新增定向搜索：

1. `gpt2::antonym` 搜索  
   - 报告：`tempdata/h3_gpt2_antonym_constructive_search_20260222.json`
   - 最优：`layer=6, top_k=32, alpha=0.25`
   - 九种子统计：`support=6`, `falsify=0`

2. `gpt2::capital` 搜索  
   - 报告：`tempdata/h3_gpt2_capital_constructive_search_20260222.json`
   - 最优：`layer=4, top_k=32, alpha=0.25`
   - 九种子统计：`support=8`, `falsify=0`

结论：

- v5 基线确认了“近支持但有波动”；
- `gpt2` 两个关键类别已找到更强且无反证的校准配置，可进入下一轮集成验证。

### 15.20 Hybrid Support Boost v6（两组三种子复验）

基于上述搜索结果新增 `hybrid_support_boost_v6`：

- `gpt2::capital -> (4,32,0.25)`
- `gpt2::antonym -> (6,32,0.25)`
- 保留 v5 的 `gpt2 math_add / distilgpt2 capital / gpt2-medium math_add` 与失败簇 neutralize。

第一组三种子（v31）：

- `tempdata/h3_holdout_validation_20260221_v31_hybridsupportv6_seed20260407.json`
- `tempdata/h3_holdout_validation_20260221_v31_hybridsupportv6_seed20260408.json`
- `tempdata/h3_holdout_validation_20260221_v31_hybridsupportv6_seed20260409.json`

结果：

1. `support_models = 1/2/2`
2. `falsify_models = 0/0/0`
3. 汇总：`support_models_avg=1.6667`

第二组三种子（v32）：

- `tempdata/h3_holdout_validation_20260221_v32_hybridsupportv6_seed20260410.json`
- `tempdata/h3_holdout_validation_20260221_v32_hybridsupportv6_seed20260411.json`
- `tempdata/h3_holdout_validation_20260221_v32_hybridsupportv6_seed20260412.json`

结果：

1. `support_models = 1/2/2`
2. `falsify_models = 0/0/0`
3. 汇总：`support_models_avg=1.6667`

合并 v31+v32（六种子）：

1. `support_models_avg=1.6667`
2. `support_models` 区间 `[1,2]`
3. `status` 计数：`provisional_support=4`, `open=2`
4. `falsify_models_max=0`
5. 失败簇定位：`tempdata/h3_failure_localization_20260221_v13_hybridsupportv6_sixseed.json`（簇数 0）

阶段结论更新：

- v6 相比 v5 显著提升了支持复验稳定性；
- 但“支持下限”仍为 1（尚未达到全种子 `>=2`）；
- H3 维持 `open_pending_replication`，当前标签：`near_support_stable_improved_pending_floor`。
